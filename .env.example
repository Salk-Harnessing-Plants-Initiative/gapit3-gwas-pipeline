# ===========================================================================
# GAPIT3 Runtime Configuration
# ===========================================================================
# These environment variables configure the GAPIT3 analysis at runtime
#
# IMPORTANT: This file is for LOCAL DEVELOPMENT ONLY
# - Local Docker:  docker run --env-file .env gapit3:latest
# - Production uses RunAI --environment or Argo env: specifications
# - NEVER commit .env file (it's gitignored)
#
# Usage Examples:
#   docker run --env-file .env gapit3:latest
#   runai workspace submit job --environment MODELS=BLINK --environment PCA_COMPONENTS=5
#   Argo: env: [{name: MODELS, value: "BLINK"}]
# ===========================================================================

# ---------------------------------------------------------------------------
# Job Identity and Paths (Set per deployment)
# ---------------------------------------------------------------------------

# Which trait column to analyze (required for single-trait analysis)
# Column 1 is Taxa, so trait indices start at 2
# Range: 2-187 for current phenotype file
TRAIT_INDEX=2

# Input data directory (mounted volume)
# Production: Set by RunAI/Argo volume mount
DATA_PATH=/data

# Output directory for results (mounted volume)
# Production: Set by RunAI/Argo volume mount
OUTPUT_PATH=/outputs

# Genotype file path (HapMap format)
# Default uses DATA_PATH, can override with full path
GENOTYPE_FILE=/data/genotype/all_chromosomes_binary.hmp.txt

# Phenotype file path (trait matrix)
# Default uses DATA_PATH, can override with full path
PHENOTYPE_FILE=/data/phenotype/traits.txt

# Accession IDs file (optional filtering)
# Leave empty or set to "" to disable filtering
ACCESSION_IDS_FILE=/data/phenotype/accession_ids.txt

# ---------------------------------------------------------------------------
# GAPIT Analysis Parameters (Container Runtime Configuration)
# ---------------------------------------------------------------------------
# Parameter naming follows GAPIT v3.0.0 conventions
# All defaults match GAPIT's native defaults for consistency.
# Legacy names (MODELS, PCA_COMPONENTS, MAF_FILTER) are still supported
# but will show deprecation warnings. Use the new names below.
#
# Reference: https://github.com/jiabowang/GAPIT (GAPIT source code)
# ---------------------------------------------------------------------------

# GWAS models to run (comma-separated, no spaces recommended)
# Options: BLINK, FarmCPU, MLM, MLMM, SUPER, CMLM, GLM
# GAPIT Default: MLM
# Note: For faster analysis, consider BLINK (faster) or FarmCPU
MODEL=MLM

# Number of principal components for population structure correction
# Range: 0-20 (0 = disable PCA correction)
# GAPIT Default: 0 (no PCA)
# Recommendation: 3-5 for structured populations, 0 if homogeneous
PCA_TOTAL=0

# Minor allele frequency filter (remove rare variants)
# Range: 0.0-0.5
# GAPIT Default: 0 (no filtering)
# Common values: 0.05 for common variants, 0.01 for rare variant analysis
SNP_MAF=0

# Significance threshold for identifying SNPs (p-value cutoff)
# GAPIT Default: 0.05
# Common alternatives:
#   0.05  = GAPIT default (5% significance)
#   5e-8  = genome-wide significance (Bonferroni)
#   1e-5  = suggestive significance
SNP_THRESHOLD=0.05

# FDR (False Discovery Rate) threshold for SNP significance
# Uses Benjamini-Hochberg correction
# Range: 0.0-1.0 (leave empty or unset to disable)
# GAPIT Default: 1 (effectively disabled)
# Common values:
#   0.05 = 5% FDR (recommended for most analyses)
#   0.1  = 10% FDR (more permissive)
# SNP_FDR=0.05

# Run multiple analysis (compare different models)
# Options: TRUE, FALSE
# GAPIT Default: TRUE
MULTIPLE_ANALYSIS=TRUE

# ---------------------------------------------------------------------------
# Advanced GAPIT Parameters
# ---------------------------------------------------------------------------

# Kinship calculation algorithm
# Options: VanRaden, Zhang, Loiselle, EMMA
# GAPIT Default: Zhang
KINSHIP_ALGORITHM=Zhang

# SNP effect model
# Options: Add (additive), Dom (dominant)
# GAPIT Default: Add
SNP_EFFECT=Add

# Missing genotype imputation method
# Options: Middle (mean), Major (major allele), Minor (minor allele)
# GAPIT Default: Middle
SNP_IMPUTE=Middle

# ---------------------------------------------------------------------------
# Computational Resources
# ---------------------------------------------------------------------------

# Number of threads for OpenBLAS linear algebra operations
# NOTE: These are set automatically by submit-all-traits-runai.sh to match CPU
# The script sets: OPENBLAS_NUM_THREADS=$CPU and OMP_NUM_THREADS=$CPU
# You don't need to set these manually - they're shown here for documentation
OPENBLAS_NUM_THREADS=12

# Number of threads for OpenMP parallel regions
# NOTE: Set automatically to match CPU allocation (same as OPENBLAS_NUM_THREADS)
OMP_NUM_THREADS=12

# ===========================================================================
# Deprecated Parameter Names (still supported with warnings)
# ===========================================================================
# The following legacy parameter names are deprecated but still work:
#   MODELS -> MODEL
#   PCA_COMPONENTS -> PCA_TOTAL
#   MAF_FILTER -> SNP_MAF
#   KINSHIP_METHOD -> KINSHIP_ALGORITHM
# Using deprecated names will show a warning in the container logs.
# ===========================================================================
# Deployment-Specific Configuration
# ===========================================================================
# These are typically NOT in .env file for local development
# Listed here for documentation - set by deployment system
# ===========================================================================

# RunAI / Kubernetes Configuration (Set by infrastructure, not .env)
# -------------------------------------------------------------------
# PROJECT=talmo-lab                     # RunAI project name
# IMAGE=ghcr.io/.../gapit3:latest      # Container image
# CPU_LIMIT=12                          # CPU cores allocated
# MEMORY_LIMIT=32Gi                     # Memory allocated
# GPU_LIMIT=0                           # GPUs (not needed for GAPIT)
# JOB_PREFIX=gapit3-trait              # Job naming prefix

# Batch Processing (For parallel trait submission scripts)
# ----------------------------------------------------------
# START_TRAIT=2                         # First trait to process
# END_TRAIT=187                         # Last trait to process
# MAX_CONCURRENT_JOBS=50                # Parallelism limit
# BATCH_ID=production-run-20250110     # Unique batch identifier

# ===========================================================================
# Example Configurations
# ===========================================================================

# Fast preliminary analysis (BLINK only, no PCA)
# MODEL=BLINK
# PCA_TOTAL=0
# SNP_THRESHOLD=1e-5

# Thorough validation run (multiple models, more PCA)
# MODEL=BLINK,FarmCPU,MLM
# PCA_TOTAL=5
# SNP_THRESHOLD=5e-8

# FDR-controlled analysis (recommended for publication)
# MODEL=BLINK,FarmCPU,MLM
# PCA_TOTAL=3
# SNP_FDR=0.05

# Rare variant analysis (lower MAF, stricter threshold)
# SNP_MAF=0.01
# SNP_THRESHOLD=1e-6

# Custom kinship and effect model
# KINSHIP_ALGORITHM=Zhang
# SNP_EFFECT=Dom

# High-memory node (more threads)
# OPENBLAS_NUM_THREADS=32
# OMP_NUM_THREADS=32

# ===========================================================================
# Notes
# ===========================================================================
#
# Environment Variable Precedence:
#   1. Command-line arguments (highest priority)
#   2. Environment variables (set by RunAI/Argo or --env-file)
#   3. Defaults in entrypoint.sh (lowest priority)
#
# Local Development:
#   cp .env.example .env
#   nano .env                              # Customize
#   docker run --env-file .env gapit3:latest
#
# RunAI Deployment:
#   runai workspace submit gapit3-trait-2 \
#     --project talmo-lab \
#     --image gapit3:latest \
#     --environment TRAIT_INDEX=2 \
#     --environment MODEL=BLINK \
#     --environment PCA_TOTAL=5 \
#     --environment SNP_MAF=0.05
#
# Argo Workflows:
#   env:
#     - name: TRAIT_INDEX
#       value: "2"
#     - name: MODEL
#       value: "BLINK,FarmCPU"
#     - name: PCA_TOTAL
#       value: "3"
#     - name: SNP_MAF
#       value: "0.05"
#
# Security:
#   - .env file is gitignored - NEVER commit it
#   - .env.example is tracked - safe to commit
#   - Production credentials go in RunAI/Argo secrets, not here
#
# ===========================================================================
